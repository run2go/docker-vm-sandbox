<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="./inc/favicon.png">
    <link rel="icon" href="./inc/favicon.svg" type="image/svg+xml">
    <title>suso.ch</title>
    <style>
        body {
            margin: 0;
            background-color: black;
            display: flex;
            height: 100vh;
        }
        .logo {
            width: 30%;
            height: 30%;
        }
    </style>
    <script src="./inc/socket.io/socket.io.min.js"></script>
    <script>
        var socket = io();

        let cmd = '';
        document.addEventListener('keydown', inputCommand);
        document.addEventListener('click', function(event) { send(event.clientX, event.clientY); });

        function inputCommand(event) {
            if (event.keyCode === 13) { // 13 = Enter > Submit command
                if (cmd !== '') send(cmd.trim());
            cmd = '';
            }
            else if (event.keyCode === 8) { // 8 = Backspace
                cmd = cmd.slice(0, -1);
            }
            else if (event.ctrlKey && event.keyCode === 67) { // ctrlKey & 67 = CTRL+C
                cmd = '';
            }
            else if (event.key.length === 1) { // Trim modifier key while allowing symbols
                cmd += event.key;
            }
            clearTimeout(timeoutHandle);
            commandTimeout(1000);
        }
        
        var timeoutHandle; // Allows resetting  timer using clearTimeout(timeoutHandle)
        function commandTimeout(time){
            timeoutHandle = window.setTimeout(
                function() {
                    cmd = ''; 
                }, time);
        }

        function send(...args) {
            let data = '';

            if (args.length === 1) { data = args[0]; }
            else if (args.length === 2) { data = JSON.stringify({ x: args[0], y: args[1] }); }

            socket.emit('cmd', data); // Transfer command to node app
        }

        socket.on('connect', () => {
            console.log('Connection established');
        });

        socket.on('output', (message) => {
            console.log('Server:', message);
        });

        socket.on('exec', (code) => {
            try {
                eval(code); // Evaluate JS code
            } catch (error) {
                console.error('Execution error:', error);
            }
        });
    </script>
</head>

<body>
    <svg class="logo" style="margin: auto; background: rgba(0, 0, 0, 0); display: block;" viewBox="0 0 100 100">
        <path fill="none" stroke="#ffffff" stroke-width="10" stroke-linecap="round" stroke-dasharray="128.3 128.3" d="M24.3 30C11.4 30 5 43.3 5 50s6.4 20 19.3 20c19.3 0 32.1-40 51.4-40 C88.6 30 95 43.3 95 50s-6.4 20-19.3 20C56.4 70 43.6 30 24.3 30z">
            <animate attributeName="stroke-dashoffset" repeatCount="indefinite" dur="3s" keyTimes="0;1" values="0;256.0"></animate>
        </path>
    </svg>
</body>

</html>